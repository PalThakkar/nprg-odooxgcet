generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String       @id @default(uuid())
  loginId      String?      @unique
  email        String       @unique
  password     String
  name         String?
  phone        String?
  address      String?
  employeeId   String?      @unique
  companyId    String?
  roleId       String
  isFirstLogin Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  avatarUrl    String?
  status       String       @default("absent")
  jobTitle     String?
  department   String?
  dateJoined   DateTime?
  salary       Float?
  data         AppData[]
  attendances  Attendance[]
  leaveRequests LeaveRequest[]
  leaveBalance LeaveBalance?
  payroll      Payroll[]
  company      Company?     @relation(fields: [companyId], references: [id])
  role         Role         @relation(fields: [roleId], references: [id])

  @@map("users")
}

model Attendance {
  id          String    @id @default(uuid())
  userId      String
  checkIn     DateTime  @default(now())
  checkOut    DateTime?
  date        DateTime  @default(now()) @db.Date
  workHours   Float?    
  extraHours  Float?    @default(0)
  status      String    @default("present") // present, absent, half-day, leave
  remarks     String?
  user        User      @relation(fields: [userId], references: [id])

  @@map("attendances")
}

model Company {
  id        String            @id @default(uuid())
  name      String
  initials  String
  logoUrl   String?
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  counters  EmployeeCounter[]
  users     User[]

  @@map("companies")
}

model EmployeeCounter {
  id        String  @id @default(uuid())
  companyId String
  year      Int
  count     Int     @default(0)
  company   Company @relation(fields: [companyId], references: [id])

  @@unique([companyId, year])
  @@map("employee_counters")
}

model Role {
  id          String  @id @default(uuid())
  name        String  @unique
  description String?
  users       User[]

  @@map("roles")
}

model AppData {
  id        String   @id @default(uuid())
  content   String
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])

  @@map("app_data")
}

model LeaveRequest {
  id          String    @id @default(uuid())
  userId      String
  startDate   DateTime  @db.Date
  endDate     DateTime  @db.Date
  leaveType   String    // paid, sick, unpaid
  reason      String?
  status      String    @default("pending") // pending, approved, rejected
  approvedBy  String?
  approvedAt  DateTime?
  remarks     String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  user        User      @relation(fields: [userId], references: [id])

  @@map("leave_requests")
}

model LeaveBalance {
  id               String @id @default(uuid())
  userId           String @unique
  paidDaysLeft     Int    @default(24)
  sickDaysLeft     Int    @default(7)
  unpaidDaysLeft   Int    @default(0)
  year             Int    @default(2025)
  updatedAt        DateTime @updatedAt
  user             User   @relation(fields: [userId], references: [id])

  @@map("leave_balances")
}

model Payroll {
  id            String   @id @default(uuid())
  userId        String
  basicSalary   Float
  allowances    Float    @default(0)
  deductions    Float    @default(0)
  netSalary     Float
  payPeriod     String   // e.g., "2025-01"
  status        String   @default("draft") // draft, processed, paid
  processedAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id])

  @@map("payrolls")
}
